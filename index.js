!function(t,e){for(var i in e)t[i]=e[i]}(exports,function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){void 0===e&&(e="string"),this.name=t,this.type=e}return t.prototype.init=function(t){var e=this;if("FooChild"===t.className&&"foo"===this.name)throw console.error("z",t.className,this.name,t.hasOwnProperty(this.name),t[this.name]),new Error("asd");t.hasOwnProperty(this.name)||Object.defineProperty(t,this.name,{get:function(){return t.getAttribute(e.name)},set:function(i){t.setAttribute(e.name,i)}})},t}();e.ModelAttribute=n;var r=function(){function t(t,e){void 0===e&&(e=[]),this._values={},this._class=this.constructor,this._class.addAttributes(e),this._initAttributes(),t&&(this.attributes=t)}return t.addAttributes=function(t){var e=this;t.forEach(function(t){var i=!1,n=null;e._attributes.forEach(function(e,r){t.name===e.name&&(n=r,i=!0)}),i?e._attributes[n]=t:e._attributes.push(t)})},t.hasAttribute=function(t){var e=!1;return this._attributes.forEach(function(i,n){t===i.name&&(e=!0)}),e},t.prototype.hasAttribute=function(t){return this._class.hasAttribute(t)},Object.defineProperty(t.prototype,"class",{get:function(){return this._class},enumerable:!0,configurable:!0}),Object.defineProperty(t,"className",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._class.name},enumerable:!0,configurable:!0}),t.prototype._initAttributes=function(){var t=this;this._class._attributes.forEach(function(e){return e.init(t)})},t.defineAttributes=function(t){this._attributes=t},t.getAttributeDefinition=function(){return this._attributes},t.prototype.setAttributes=function(t){for(var e=Object.keys(t),i=0,n=e.length;i<n;i++)this._values[e[i]]=t[e[i]]},Object.defineProperty(t.prototype,"attributes",{get:function(){return this._values},set:function(t){this.setAttributes(t)},enumerable:!0,configurable:!0}),t.prototype.setAttribute=function(t,e){this._values[t]=e},t.prototype.getAttribute=function(t){return this._values[t]},t._attributes=[],t}();e.Model=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this._params={fields:[],limit:{start:0,end:void 0},sort:[],where:{}},t.init(),this._db=t.db,this._model=t}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"db",{get:function(){return this._db},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"model",{get:function(){return this._model},enumerable:!0,configurable:!0}),t.prototype.fields=function(t){var e=t;return"string"===t.constructor.name&&(e=[t]),this._params.fields=e,this},t.prototype.sort=function(t){var e=t;return"string"===t.constructor.name&&(e=[t]),this._params.sort=e,this},t.prototype.limit=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=null),this._params.limit.start=t,this._params.limit.end=e,this},t.prototype.where=function(t){return void 0===t&&(t={}),this._params.where=t,this},t}();e.ActiveQuery=n},function(t,e,i){"use strict";function n(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),n(i(1)),n(i(3)),n(i(4)),n(i(0))},function(t,e,i){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),r=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}var n,r,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),a=function(t){function e(e){var i=t.call(this,e)||this;return i._class.init(),i._initRelations(),i}return n(e,t),Object.defineProperty(e,"db",{get:function(){return this._db[this.config.tableName]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"db",{get:function(){return this._class.db[this._class.config.tableName]},enumerable:!0,configurable:!0}),e._dbInit=function(){return this.initialized(this.config.tableName),Promise.resolve(!0)},e.initialized=function(t){this._initialized[t]=!0},Object.defineProperty(e,"config",{get:function(){return this._config[this._tableName]},set:function(t){var e=this;Object.keys(t).forEach(function(i){e._config[i]=t[i]})},enumerable:!0,configurable:!0}),e.init=function(){return r(this,void 0,void 0,function(){return o(this,function(t){return this._initialized[this._tableName]?[2]:(this._config[this._tableName]={identifier:this._identifier||this._defaultConfig.identifier,tableName:this._tableName||this._defaultConfig.tableName,queryClass:this._queryClass||this._defaultConfig.queryClass},[2,this._dbInit()])})})},e.prototype._initRelations=function(){var t=this;this._class._relations.forEach(function(e){return e.init(t)})},e.addRelation=function(t){this._relations.push(t)},Object.defineProperty(e.prototype,"id",{get:function(){return this.getAttribute(this._class.config.identifier)},set:function(t){this.id||this.setAttribute(this._class.config.identifier,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNewRecord",{get:function(){return!this.id},enumerable:!0,configurable:!0}),e.find=function(){return this.init(),new this.config.queryClass(this)},e.findOne=function(t){if(void 0===t&&(t={}),this.init(),"string"==typeof t){var e={};return e[this.config.identifier]=t,this.find().where(e).one()}return this.find().where(t).one()},e.findAll=function(t){return void 0===t&&(t={}),this.find().where(t).all()},e.save=function(t){return r(this,void 0,void 0,function(){return o(this,function(t){throw new Error("Model.save() needs to be set!")})})},e._relations=[],e._defaultConfig={identifier:"id",tableName:"ActiveRecord",queryClass:s.ActiveQuery},e._config={},e._db={},e._initialized={},e}(i(0).Model);e.ActiveRecord=a},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}var n,r,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),s=1,a=2,u=3,c=function(){function t(t,e){this._child=t._child,this._foreignKey=t._foreignKey,this._intermediate=t._intermediate,this._key=t._key,this._label=this._formatLabel(t._label),this._property=t._property,this._type=t._type}return t.prototype._formatLabel=function(t){var e="s"===t[t.length-1]?t.substr(0,t.length-1):t,i="s"===t[t.length-1]?t:t+"s";return{original:t,singular:e,plural:i,capitalizedSingular:e[0].toUpperCase()+e.slice(1),capitalizedPlural:i[0].toUpperCase()+i.slice(1)}},t.hasOne=function(t,e,i){return new this({_child:e,_label:t,_property:i,_type:s})},t.hasMany=function(t,e,i){return new this({_child:e,_label:t,_property:i,_type:a})},t.manyToMany=function(t,e,i,n,r){return new this({_child:e,_foreignKey:r,_intermediate:i,_key:n,_label:t,_type:u})},t.prototype.init=function(t){var e={};this._type===s?this._initHasOne(t,e):this._type===a?this._initHasMany(t,e):this._type===u&&this._initManyToMany(t,e)},t.prototype._initHasOne=function(t,e){var i=this,s=new o.ModelAttribute(this._property,"string");t.class.addAttributes([s]),s.init(t),t.setAttribute(this._property,t.getAttribute(this._property)||null),t.hasOwnProperty(this._label.original)||Object.defineProperty(t,this._label.original,{get:function(){return i._child.findOne(t.getAttribute(i._property))}}),t.hasOwnProperty(this._property)||Object.defineProperty(t,this._property,{get:function(){return t.getAttribute(i._property)}}),t["set"+this._label.capitalizedSingular]=function(e){return n(i,void 0,void 0,function(){return r(this,function(i){switch(i.label){case 0:return e instanceof this._child||(e=new this._child(e)),[4,e.save()];case 1:return i.sent(),t.setAttribute(this._property,e.getAttribute(this._child.config.identifier)),[2,e]}})})}},t.prototype._initHasMany=function(t,e){var i=this,s=new o.ModelAttribute(this._property,"foreignKey");this._child.addAttributes([s]),s.init(t),Object.defineProperty(t,this._label.plural,{get:function(){return n(i,void 0,void 0,function(){return r(this,function(i){switch(i.label){case 0:return[4,this._child.init()];case 1:return i.sent(),e[this._property]=t.getAttribute(this._child.config.identifier),[4,new t.class.config.queryClass(this._child).where(e).all()];case 2:return[2,i.sent()]}})})}}),t["get"+this._label.capitalizedPlural]=function(){return n(i,void 0,void 0,function(){return r(this,function(i){switch(i.label){case 0:return e[this._property]=t.getAttribute(this._child.config.identifier),[4,new t.class.config.queryClass(this._child).where(e)];case 1:return[2,i.sent()]}})})},t["add"+this._label.capitalizedSingular]=function(e){return n(i,void 0,void 0,function(){var i;return r(this,function(n){switch(n.label){case 0:return[4,t["add"+this._label.capitalizedPlural]([e])];case 1:return i=n.sent(),[2,i[0]]}})})},t["add"+this._label.capitalizedPlural]=function(e){return n(i,void 0,void 0,function(){var i=this;return r(this,function(n){switch(n.label){case 0:return e.length?(e=e.map(function(e){return e[i._property]=t.getAttribute(i._child.config.identifier),e}),[4,this._child.save(e)]):[2];case 1:return[2,n.sent()]}})})}},t.prototype._initManyToMany=function(t,e){var i=this,s=new o.ModelAttribute(this._foreignKey,"foreignKey");this._intermediate.addAttributes([s]),s.init(t),t.hasOwnProperty(this._label.plural)||Object.defineProperty(t,this._label.plural,{get:function(){return n(i,void 0,void 0,function(){var i,n,o,s=this;return r(this,function(r){switch(r.label){case 0:return[4,this._child.init()];case 1:return r.sent(),e[this._key]=t.getAttribute(t.class.config.identifier),[4,this._intermediate.find().where(e).fields([this._foreignKey]).all(!1)];case 2:return(i=r.sent()).length?(n=i.map(function(t){return t.getAttribute(s._foreignKey)}).filter(Boolean),o={},o[this._child.config.identifier]={$in:n},[4,new t.class.config.queryClass(this._child).where(o).all()]):[2,[]];case 3:return[2,r.sent()]}})})}}),t["get"+this._label.capitalizedPlural]=function(){return n(i,void 0,void 0,function(){var i,n,o,s=this;return r(this,function(r){switch(r.label){case 0:return e[this._key]=t.getAttribute(this._child.config.identifier),[4,this._intermediate.find().where(e).fields([this._foreignKey]).all(!1)];case 1:return(i=r.sent()).length?(n=i.map(function(t){return t.getAttribute(s._foreignKey)}).filter(Boolean),o={},o[this._child.config.identifier]={$in:n},[4,new t.class.config.queryClass(this._child).where(o)]):[2,[]];case 2:return[2,r.sent()]}})})},t["add"+this._label.capitalizedSingular]=function(e){return n(i,void 0,void 0,function(){var i;return r(this,function(n){switch(n.label){case 0:return[4,t["add"+this._label.capitalizedPlural]([e])];case 1:return i=n.sent(),[2,i[0]]}})})},t["add"+this._label.capitalizedPlural]=function(e){return n(i,void 0,void 0,function(){var i,n,o,s,a,u,c,l,f,h=this;return r(this,function(d){switch(d.label){case 0:return e.length?[4,this._child.save(e)]:[2];case 1:return i=d.sent(),n={},n[this._foreignKey]={$in:i.map(function(t){return t.getAttribute(h._child.config.identifier)})},[4,this._intermediate.findAll(n)];case 2:o=d.sent(),s=function(e){var i,n;return r(this,function(r){switch(r.label){case 0:return u=!1,o.length&&o.forEach(function(t){u=u||e.getAttribute(h._child.config.identifier)===t.getAttribute(h._foreignKey)}),u?[3,2]:(i={},i[a._key]=t.getAttribute(a._child.config.identifier),i[a._foreignKey]=e.getAttribute(a._child.config.identifier),n=new a._intermediate(i),[4,n.save()]);case 1:r.sent(),r.label=2;case 2:return[2]}})},a=this,c=0,l=i,d.label=3;case 3:return c<l.length?(f=l[c],[5,s(f)]):[3,6];case 4:d.sent(),d.label=5;case 5:return c++,[3,3];case 6:return[2,i]}})})}},t}();e.ActiveRecordRelation=c}]));